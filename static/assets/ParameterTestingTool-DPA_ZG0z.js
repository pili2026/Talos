import{d as oe,r as p,c as W,a as Q,b as Y,e as re,u as ne,s as ie,o as ce,f as v,g as i,h as S,i as C,w as o,j as b,k as u,E as D,l as r,t as n,m as y,n as ue,F as $,p as O,q as de,v as ve,x as pe,y as me,z as _e,A as c,_ as fe}from"./index-BSk7bESv.js";const he=oe("device",()=>{const w=p([]),g=p(null),l=p([]),_=p([]),f=p({}),m=p(!1),k=p(null),X=W(()=>g.value&&w.value.find(e=>e.device_id===g.value)||null),B=W(()=>w.value.filter(e=>l.value.includes(e.device_id))),F=W(()=>w.value.filter(e=>!!e.is_online).length);function U(e){return{device_id:e.device_id,model:e.model,slave_address:parseInt(e.slave_id),is_online:e.connection_status==="online"}}function h(e){const d=e.available_parameters.map(a=>{const s=/^(DI|DO|ERROR|ALERT|STATUS|ON_OFF|RESET|RW_ON_OFF|RW_RESET|INVSTATUS)/.test(a);return{name:a,type:s?"digital":"analog"}});return{device_id:e.device_id,model:e.model,slave_address:parseInt(e.slave_id),is_online:e.connection_status==="online",parameters:d}}const A=async()=>{m.value=!0,k.value=null;try{const e=await Q.getAllDevices(!1);w.value=e.devices.map(U),console.log(`[Device Store] Loaded ${w.value.length} devices:`,w.value)}catch(e){const d=e?.message??"Failed to load devices";throw k.value=d,console.error("[Device Store] Load devices error:",e),e}finally{m.value=!1}},z=async e=>{try{if(f.value[e])return console.log(`[Device Store] Using cached details for: ${e}`),f.value[e];console.log(`[Device Store] Loading details for device: ${e}`);const d=await Q.getDeviceDetails(e,!0),a=h(d);return f.value[e]=a,console.log(`[Device Store] Loaded details for ${e}:`,a),console.log("[Device Store] Available parameters:",a.parameters),a}catch(d){throw console.error(`[Device Store] Failed to load device ${e}:`,d),d}},P=async e=>{g.value=e,console.log(`[Device Store] Selected device: ${e}`),f.value[e]||await z(e)},R=()=>{g.value=null,_.value=[]},x=e=>{l.value=e},N=e=>{_.value=e},M=e=>{const d=f.value[e];if(!d||!d.parameters)return console.warn(`[Device Store] No parameters found for device: ${e}`),[];const a=Array.isArray(d.parameters)?d.parameters:[];return console.log(`[Device Store] Returning ${a.length} parameters for ${e}`),a.map(s=>({...s}))},V=(e,d)=>{const a=f.value[e];if(!a||!a.parameters)return null;const T=(Array.isArray(a.parameters)?a.parameters:[]).find(E=>E.name===d);return T?{...T}:null},j=async e=>{try{const d=await Q.checkConnectivity(e),a=w.value.find(s=>s.device_id===e);return a&&(a.is_online=d.is_online),d.is_online}catch(d){return console.error(`[Device Store] Check connectivity error for ${e}:`,d),!1}},q=async e=>{try{const d=await Q.batchCheckConnectivity(e);Object.entries(d).forEach(([a,s])=>{const T=w.value.find(E=>E.device_id===a);T&&(T.is_online=s)})}catch(d){console.error("[Device Store] Batch check connectivity error:",d)}};return{devices:w,selectedDeviceId:g,selectedDeviceIds:l,selectedParameters:_,deviceDetails:f,loading:m,error:k,selectedDevice:X,selectedDevices:B,onlineDeviceCount:F,loadAllDevices:A,loadDeviceDetails:z,selectDevice:P,deselectDevice:R,selectMultipleDevices:x,selectParameters:N,getDeviceParameters:M,getParameterInfo:V,checkDeviceConnectivity:j,batchCheckConnectivity:q,refreshAllDeviceStatus:async()=>{const e=w.value.map(d=>d.device_id);await q(e)},$reset:()=>{w.value=[],g.value=null,l.value=[],_.value=[],f.value={},m.value=!1,k.value=null}}});class ye{async readSingleParameter(g,l){const _={device_id:g,parameter:l};return(await Y.post("/parameters/read",_)).data}async readMultipleParameters(g,l){const _={device_id:g,parameters:l};return(await Y.post("/parameters/read-multiple",_)).data}async writeParameter(g,l,_,f=!1){const m={device_id:g,parameter:l,value:_,force:f};return(await Y.post("/parameters/write",m)).data}}const Z=new ye,ge={class:"parameter-tool"},we={class:"header-content"},Te={class:"title-section"},De={class:"card-header"},Se={key:0,class:"operations-section"},be={class:"card-header"},ke={class:"operation-form"},Pe={key:0,class:"result-box"},Ve={class:"result-title"},Ae={class:"param-name"},Ce={class:"param-value"},Fe={key:0,class:"unit"},Re={key:0,class:"error-message"},xe={class:"card-header"},Ee={class:"operation-form"},$e={key:0,class:"result-box"},ze={class:"parameter-list"},Ue={class:"param-header"},Ne={class:"param-name"},Me={class:"param-body"},Le={key:0,class:"param-value"},Oe={key:1,class:"param-value"},We={key:0,class:"unit"},Be={key:1,class:"error-text"},je={class:"card-header"},qe={class:"operation-form"},Ge={class:"write-options"},He={key:0,class:"result-box"},Je={class:"write-details"},Ke={class:"detail-row"},Qe={class:"label"},Xe={class:"value"},Ye={class:"detail-row"},Ze={class:"label"},Ie={class:"value"},ea={class:"detail-row"},aa={class:"label"},la={class:"value"},ta={key:0,class:"detail-row"},sa=re({__name:"ParameterTestingTool",setup(w){const g=ne(),{t:l}=ie(g),_=he(),f=p(!1),m=p(null),k=p([]),X=W(()=>_.devices),B=W(()=>_.selectedDevice),F=p(""),U=p(!1),h=p(null),A=p([]),z=p(!1),P=p(null),R=p(""),x=p(null),N=p(!1),M=p(!1),V=p(null);async function j(){f.value=!0;try{await _.loadAllDevices(),D.success(l.value.parameterTool.devicesLoaded)}catch(a){D.error(l.value.parameterTool.loadDevicesFailed),console.error("[Parameter Tool] Failed to load devices:",a)}finally{f.value=!1}}async function q(a){try{await _.loadDeviceDetails(a),await _.selectDevice(a),k.value=_.getDeviceParameters(a),h.value=null,P.value=null,V.value=null,F.value="",A.value=[],R.value="",x.value=null;const s=l.value.parameterTool.deviceSelected.replace("{device}",a);D.success(s)}catch(s){D.error(l.value.parameterTool.loadDeviceDetailsFailed),console.error("[Parameter Tool] Failed to load device details:",s)}}async function I(){if(!(!m.value||!F.value)){U.value=!0,h.value=null;try{const a=await Z.readSingleParameter(m.value,F.value);h.value=a,a.parameter.is_valid&&a.parameter.value!==-1&&D.success(l.value.parameterTool.readSuccess)}catch(a){D.error(a.message||l.value.parameterTool.readError),console.error("[Parameter Tool] Failed to read parameter:",a)}finally{U.value=!1}}}async function ee(){if(!(!m.value||A.value.length===0)){z.value=!0,P.value=null;try{const a=await Z.readMultipleParameters(m.value,A.value);if(P.value=a,a.status==="success")D.success(l.value.parameterTool.readSuccess);else if(a.status==="partial_success"){const s=l.value.parameterTool.partialSuccess.replace("{success}",a.success_count.toString()).replace("{total}",a.parameters.length.toString());D.warning(s)}else D.error(l.value.parameterTool.readFailed)}catch(a){D.error(a.message||l.value.parameterTool.readError),console.error("[Parameter Tool] Failed to read parameters:",a)}finally{z.value=!1}}}async function e(){if(!(!m.value||!R.value||x.value===null)){M.value=!0,V.value=null;try{const a=await Z.writeParameter(m.value,R.value,x.value,N.value);V.value=a,D.success(l.value.parameterTool.writeSuccess)}catch(a){D.error(a.message||l.value.parameterTool.writeError),console.error("[Parameter Tool] Failed to write parameter:",a)}finally{M.value=!1}}}function d(a){return a.status==="success"?"success":a.status==="partial_success"?"warning":"error"}return ce(()=>{j()}),(a,s)=>{const T=b("el-tag"),E=b("el-button"),L=b("el-card"),G=b("el-option"),H=b("el-select"),J=b("el-alert"),K=b("el-icon"),ae=b("el-input-number"),le=b("el-checkbox"),te=b("el-tooltip"),se=b("el-empty");return c(),v("div",ge,[i(L,{class:"header-card",shadow:"never"},{default:o(()=>[r("div",we,[r("div",Te,[r("h2",null,n(u(l).parameterTool.title),1),i(T,{type:"info",size:"small"},{default:o(()=>[y(n(u(l).parameterTool.subtitle),1)]),_:1})]),i(E,{icon:u(ue),circle:"",onClick:j,loading:f.value,title:u(l).parameterTool.refresh},null,8,["icon","loading","title"])])]),_:1}),i(L,{class:"device-selection",shadow:"hover"},{header:o(()=>[r("div",De,[r("span",null,n(u(l).parameterTool.deviceSelection),1),B.value?(c(),C(T,{key:0,type:"success",size:"small"},{default:o(()=>[y(n(B.value.device_id),1)]),_:1})):S("",!0)])]),default:o(()=>[i(H,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=t=>m.value=t),placeholder:u(l).parameterTool.selectDevice,size:"large",filterable:"",onChange:q,style:{width:"100%"}},{default:o(()=>[(c(!0),v($,null,O(X.value,t=>(c(),C(G,{key:t.device_id,label:`${t.device_id} - ${t.model||"Unknown"}`,value:t.device_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),m.value?(c(),C(J,{key:0,type:"info",closable:!1,style:{"margin-top":"12px"}},{title:o(()=>[...s[6]||(s[6]=[r("div",{style:{"font-size":"13px"}},"ðŸ’¡ This tool uses RESTful API for parameter operations",-1)])]),_:1})):S("",!0)]),_:1}),m.value?(c(),v("div",Se,[i(L,{class:"operation-card",shadow:"hover"},{header:o(()=>[r("div",be,[i(K,null,{default:o(()=>[i(u(de))]),_:1}),r("span",null,n(u(l).parameterTool.readSingle),1)])]),default:o(()=>[r("div",ke,[i(H,{modelValue:F.value,"onUpdate:modelValue":s[1]||(s[1]=t=>F.value=t),placeholder:u(l).parameterTool.selectParameter,filterable:"","allow-create":"",style:{width:"100%"}},{default:o(()=>[(c(!0),v($,null,O(k.value,t=>(c(),C(G,{key:t.name,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),i(E,{type:"primary",loading:U.value,onClick:I,disabled:!F.value,style:{width:"100%"}},{default:o(()=>[y(n(u(l).parameterTool.read),1)]),_:1},8,["loading","disabled"]),h.value?(c(),v("div",Pe,[i(J,{type:h.value.parameter.is_valid?"success":"error",closable:!1,"show-icon":""},{title:o(()=>[r("div",Ve,[r("span",Ae,n(h.value.parameter.name),1),r("span",Ce,[h.value.parameter.is_valid?(c(),v($,{key:0},[h.value.parameter.value===-1?(c(),C(T,{key:0,type:"warning",size:"small"},{default:o(()=>[...s[7]||(s[7]=[y("N/A",-1)])]),_:1})):(c(),v($,{key:1},[y(n(h.value.parameter.value)+" ",1),h.value.parameter.unit?(c(),v("span",Fe,n(h.value.parameter.unit),1)):S("",!0)],64))],64)):(c(),C(T,{key:1,type:"danger",size:"small"},{default:o(()=>[...s[8]||(s[8]=[y("Failed",-1)])]),_:1}))])])]),default:o(()=>[h.value.parameter.is_valid?S("",!0):(c(),v("div",Re,n(h.value.parameter.error_message||h.value.message),1))]),_:1},8,["type"])])):S("",!0)])]),_:1}),i(L,{class:"operation-card",shadow:"hover"},{header:o(()=>[r("div",xe,[i(K,null,{default:o(()=>[i(u(pe))]),_:1}),r("span",null,n(u(l).parameterTool.readMultiple),1)])]),default:o(()=>[r("div",Ee,[i(H,{modelValue:A.value,"onUpdate:modelValue":s[2]||(s[2]=t=>A.value=t),placeholder:u(l).parameterTool.selectParameters,filterable:"",multiple:"","allow-create":"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"100%"}},{default:o(()=>[(c(!0),v($,null,O(k.value,t=>(c(),C(G,{key:t.name,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),i(E,{type:"primary",loading:z.value,onClick:ee,disabled:A.value.length===0,style:{width:"100%"}},{default:o(()=>[y(n(u(l).parameterTool.read)+" ("+n(A.value.length)+") ",1)]),_:1},8,["loading","disabled"]),P.value?(c(),v("div",$e,[i(J,{type:d(P.value),closable:!1,"show-icon":""},{title:o(()=>[y(n(u(l).parameterTool.readResults)+": "+n(P.value.success_count)+" / "+n(P.value.parameters.length),1)]),_:1},8,["type"]),r("div",ze,[(c(!0),v($,null,O(P.value.parameters,t=>(c(),v("div",{key:t.name,class:ve(["parameter-item",{"parameter-error":!t.is_valid}])},[r("div",Ue,[r("span",Ne,n(t.name),1),i(T,{type:t.is_valid?"success":"danger",size:"small"},{default:o(()=>[y(n(t.is_valid?"âœ“":"âœ—"),1)]),_:2},1032,["type"])]),r("div",Me,[t.is_valid?(c(),v($,{key:0},[t.value===-1?(c(),v("span",Le,[i(T,{type:"warning",size:"small"},{default:o(()=>[...s[9]||(s[9]=[y("N/A",-1)])]),_:1})])):(c(),v("span",Oe,[y(n(t.value)+" ",1),t.unit?(c(),v("span",We,n(t.unit),1)):S("",!0)]))],64)):(c(),v("span",Be,n(t.error_message),1))])],2))),128))])])):S("",!0)])]),_:1}),i(L,{class:"operation-card",shadow:"hover"},{header:o(()=>[r("div",je,[i(K,null,{default:o(()=>[i(u(_e))]),_:1}),r("span",null,n(u(l).parameterTool.write),1)])]),default:o(()=>[r("div",qe,[i(H,{modelValue:R.value,"onUpdate:modelValue":s[3]||(s[3]=t=>R.value=t),placeholder:u(l).parameterTool.selectParameter,filterable:"","allow-create":"",style:{width:"100%"}},{default:o(()=>[(c(!0),v($,null,O(k.value,t=>(c(),C(G,{key:t.name,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),i(ae,{modelValue:x.value,"onUpdate:modelValue":s[4]||(s[4]=t=>x.value=t),placeholder:u(l).parameterTool.enterValue,controls:!0,precision:2,style:{width:"100%"}},null,8,["modelValue","placeholder"]),r("div",Ge,[i(le,{modelValue:N.value,"onUpdate:modelValue":s[5]||(s[5]=t=>N.value=t)},{default:o(()=>[y(n(u(l).parameterTool.forceWrite),1)]),_:1},8,["modelValue"]),i(te,{content:u(l).parameterTool.forceWriteTooltip,placement:"top"},{default:o(()=>[i(K,{class:"info-icon"},{default:o(()=>[i(u(me))]),_:1})]),_:1},8,["content"])]),i(E,{type:"danger",loading:M.value,onClick:e,disabled:!R.value||x.value===null,style:{width:"100%"}},{default:o(()=>[y(n(u(l).parameterTool.write),1)]),_:1},8,["loading","disabled"]),V.value?(c(),v("div",He,[i(J,{type:"success",closable:!1,"show-icon":""},{title:o(()=>[y(n(u(l).parameterTool.writeSuccess),1)]),default:o(()=>[r("div",Je,[r("div",Ke,[r("span",Qe,n(u(l).parameterTool.parameter)+":",1),r("span",Xe,n(V.value.parameter),1)]),r("div",Ye,[r("span",Ze,n(u(l).parameterTool.previousValue)+":",1),r("span",Ie,n(V.value.previous_value??"N/A"),1)]),r("div",ea,[r("span",aa,n(u(l).parameterTool.newValue)+":",1),r("span",la,n(V.value.new_value),1)]),V.value.was_forced?(c(),v("div",ta,[i(T,{type:"warning",size:"small"},{default:o(()=>[y(n(u(l).parameterTool.forcedWrite),1)]),_:1})])):S("",!0)])]),_:1})])):S("",!0)])]),_:1})])):S("",!0),m.value?S("",!0):(c(),C(se,{key:1,description:u(l).parameterTool.selectDeviceFirst,"image-size":150},null,8,["description"]))])}}}),ra=fe(sa,[["__scopeId","data-v-8f26a3d6"]]);export{ra as default};
