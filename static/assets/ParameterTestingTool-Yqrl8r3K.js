import{d as oe,r as v,c as j,a as K,b as Z,e as re,u as ne,s as ce,o as ie,f as m,g as n,h as P,i as M,w as r,j as D,k as c,E as g,l as s,t as o,m as w,n as ue,F as N,p as W,q as de,v as ve,x as pe,y as _e,z as me,A as u,_ as fe}from"./index-DM8-lh-a.js";const he=oe("device",()=>{const T=v([]),y=v(null),e=v([]),p=v([]),f=v({}),_=v(!1),k=v(null),Q=j(()=>y.value&&T.value.find(l=>l.device_id===y.value)||null),q=j(()=>T.value.filter(l=>e.value.includes(l.device_id))),F=j(()=>T.value.filter(l=>!!l.is_online).length),$=async()=>{_.value=!0,k.value=null;try{const l=await K.getAllDevices();T.value=l.devices,console.log(`Loaded ${T.value.length} devices`)}catch(l){const i=l?.message??"Failed to load devices";throw k.value=i,console.error("Load devices error:",l),l}finally{_.value=!1}},h=async l=>{try{if(f.value[l])return f.value[l];const i=await K.getDeviceDetails(l);return f.value[l]=i,console.log(`Loaded details for device: ${l}`),i}catch(i){throw console.error(`Failed to load device ${l}:`,i),i}},C=async l=>{y.value=l,f.value[l]||await h(l)},E=()=>{y.value=null,p.value=[]},V=l=>{e.value=l},x=l=>{p.value=l},A=l=>{const i=f.value[l];return(Array.isArray(i?.parameters)?i.parameters:[]).map(z=>({...z}))},U=(l,i)=>{const S=f.value[l],t=(Array.isArray(S?.parameters)?S.parameters:[]).find(d=>d.name===i);return t?{...t}:null},R=async l=>{try{const i=await K.checkConnectivity(l),S=T.value.find(z=>z.device_id===l);return S&&(S.is_online=i.is_online),i.is_online}catch(i){return console.error(`Check connectivity error for ${l}:`,i),!1}},b=async l=>{try{const i=await K.batchCheckConnectivity(l);Object.entries(i).forEach(([S,z])=>{const t=T.value.find(d=>d.device_id===S);t&&(t.is_online=z)})}catch(i){console.error("Batch check connectivity error:",i)}};return{devices:T,selectedDeviceId:y,selectedDeviceIds:e,selectedParameters:p,deviceDetails:f,loading:_,error:k,selectedDevice:Q,selectedDevices:q,onlineDeviceCount:F,loadAllDevices:$,loadDeviceDetails:h,selectDevice:C,deselectDevice:E,selectMultipleDevices:V,selectParameters:x,getDeviceParameters:A,getParameterInfo:U,checkDeviceConnectivity:R,batchCheckConnectivity:b,refreshAllDeviceStatus:async()=>{const l=T.value.map(i=>i.device_id);await b(l)},$reset:()=>{T.value=[],y.value=null,e.value=[],p.value=[],f.value={},_.value=!1,k.value=null}}});class ye{async readSingleParameter(y,e){const p={device_id:y,parameter:e};return(await Z.post("/parameters/read",p)).data}async readMultipleParameters(y,e){const p={device_id:y,parameters:e};return(await Z.post("/parameters/read-multiple",p)).data}async writeParameter(y,e,p,f=!1){const _={device_id:y,parameter:e,value:p,force:f};return(await Z.post("/parameters/write",_)).data}}const I=new ye,ge={class:"parameter-tool"},we={class:"header-content"},Te={class:"title-section"},be={class:"card-header"},De={class:"device-option"},ke={key:0,class:"operations-section"},Ve={class:"card-header"},Se={class:"operation-form"},Pe={key:0,class:"result-box"},Ce={class:"result-title"},Fe={class:"param-name"},xe={class:"param-value"},Ae={key:0,class:"unit"},ze={key:0,class:"error-message"},Me={class:"card-header"},$e={class:"operation-form"},Ee={key:0,class:"result-box"},Ue={class:"parameter-list"},Re={class:"param-header"},Be={class:"param-name"},Le={class:"param-body"},Ne={key:0,class:"param-value"},We={key:0,class:"unit"},je={key:1,class:"error-text"},qe={class:"card-header"},Oe={class:"operation-form"},Ge={class:"write-options"},He={key:0,class:"result-box"},Je={class:"write-details"},Ke={class:"detail-row"},Qe={class:"label"},Xe={class:"value"},Ye={class:"detail-row"},Ze={class:"label"},Ie={class:"value"},ea={class:"detail-row"},aa={class:"label"},la={class:"value"},ta={key:0,class:"detail-row"},sa=re({__name:"ParameterTestingTool",setup(T){const y=ne(),{t:e}=ce(y),p=he(),f=v(!1),_=v(null),k=v([]),Q=j(()=>p.devices),q=j(()=>p.selectedDevice),F=v(""),$=v(!1),h=v(null),C=v([]),E=v(!1),V=v(null),x=v(""),A=v(null),U=v(!1),R=v(!1),b=v(null);async function X(){f.value=!0;try{await p.loadAllDevices(),g.success(e.value.parameterTool.devicesLoaded)}catch(t){g.error(e.value.parameterTool.loadDevicesFailed),console.error("Failed to load devices:",t)}finally{f.value=!1}}async function ee(t){try{await p.loadDeviceDetails(t),await p.selectDevice(t),k.value=p.getDeviceParameters(t),h.value=null,V.value=null,b.value=null,F.value="",C.value=[],x.value="",A.value=null;const d=e.value.parameterTool.deviceSelected.replace("{device}",t);g.success(d)}catch(d){g.error(e.value.parameterTool.loadDeviceDetailsFailed),console.error("Failed to load device details:",d)}}async function l(){if(!(!_.value||!F.value)){$.value=!0,h.value=null;try{const t=await I.readSingleParameter(_.value,F.value);h.value=t,t.parameter.is_valid?g.success(e.value.parameterTool.readSuccess):g.warning(e.value.parameterTool.readFailed)}catch(t){g.error(t.message||e.value.parameterTool.readError),console.error("Failed to read parameter:",t)}finally{$.value=!1}}}async function i(){if(!(!_.value||C.value.length===0)){E.value=!0,V.value=null;try{const t=await I.readMultipleParameters(_.value,C.value);if(V.value=t,t.status==="success")g.success(e.value.parameterTool.readSuccess);else if(t.status==="partial_success"){const d=e.value.parameterTool.partialSuccess.replace("{success}",t.success_count.toString()).replace("{total}",t.parameters.length.toString());g.warning(d)}else g.error(e.value.parameterTool.readFailed)}catch(t){g.error(t.message||e.value.parameterTool.readError),console.error("Failed to read parameters:",t)}finally{E.value=!1}}}async function S(){if(!(!_.value||!x.value||A.value===null)){R.value=!0,b.value=null;try{const t=await I.writeParameter(_.value,x.value,A.value,U.value);b.value=t,g.success(e.value.parameterTool.writeSuccess)}catch(t){g.error(t.message||e.value.parameterTool.writeError),console.error("Failed to write parameter:",t)}finally{R.value=!1}}}function z(t){return t.status==="success"?"success":t.status==="partial_success"?"warning":"error"}return ie(()=>{X()}),(t,d)=>{const B=D("el-tag"),O=D("el-button"),L=D("el-card"),G=D("el-option"),H=D("el-select"),J=D("el-icon"),Y=D("el-alert"),ae=D("el-input-number"),le=D("el-checkbox"),te=D("el-tooltip"),se=D("el-empty");return u(),m("div",ge,[n(L,{class:"header-card",shadow:"never"},{default:r(()=>[s("div",we,[s("div",Te,[s("h2",null,o(c(e).parameterTool.title),1),n(B,{type:"info",size:"small"},{default:r(()=>[w(o(c(e).parameterTool.subtitle),1)]),_:1})]),n(O,{icon:c(ue),circle:"",onClick:X,loading:f.value,title:c(e).parameterTool.refresh},null,8,["icon","loading","title"])])]),_:1}),n(L,{class:"device-selection",shadow:"hover"},{header:r(()=>[s("div",be,[s("span",null,o(c(e).parameterTool.deviceSelection),1),q.value?(u(),M(B,{key:0,type:"success",size:"small"},{default:r(()=>[w(o(q.value.device_id),1)]),_:1})):P("",!0)])]),default:r(()=>[n(H,{modelValue:_.value,"onUpdate:modelValue":d[0]||(d[0]=a=>_.value=a),placeholder:c(e).parameterTool.selectDevice,size:"large",filterable:"",onChange:ee,style:{width:"100%"}},{default:r(()=>[(u(!0),m(N,null,W(Q.value,a=>(u(),M(G,{key:a.device_id,label:`${a.device_id} - ${a.model}`,value:a.device_id},{default:r(()=>[s("div",De,[s("span",null,o(a.device_id),1),n(B,{type:a.is_online?"success":"danger",size:"small"},{default:r(()=>[w(o(a.is_online?c(e).parameterTool.online:c(e).parameterTool.offline),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),_.value?(u(),m("div",ke,[n(L,{class:"operation-card",shadow:"hover"},{header:r(()=>[s("div",Ve,[n(J,null,{default:r(()=>[n(c(de))]),_:1}),s("span",null,o(c(e).parameterTool.readSingle),1)])]),default:r(()=>[s("div",Se,[n(H,{modelValue:F.value,"onUpdate:modelValue":d[1]||(d[1]=a=>F.value=a),placeholder:c(e).parameterTool.selectParameter,filterable:"","allow-create":"",style:{width:"100%"}},{default:r(()=>[(u(!0),m(N,null,W(k.value,a=>(u(),M(G,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),n(O,{type:"primary",loading:$.value,onClick:l,disabled:!F.value,style:{width:"100%"}},{default:r(()=>[w(o(c(e).parameterTool.read),1)]),_:1},8,["loading","disabled"]),h.value?(u(),m("div",Pe,[n(Y,{type:h.value.parameter.is_valid?"success":"error",closable:!1,"show-icon":""},{title:r(()=>[s("div",Ce,[s("span",Fe,o(h.value.parameter.name),1),s("span",xe,[w(o(h.value.parameter.value)+" ",1),h.value.parameter.unit?(u(),m("span",Ae,o(h.value.parameter.unit),1)):P("",!0)])])]),default:r(()=>[h.value.parameter.is_valid?P("",!0):(u(),m("div",ze,o(h.value.parameter.error_message||h.value.message),1))]),_:1},8,["type"])])):P("",!0)])]),_:1}),n(L,{class:"operation-card",shadow:"hover"},{header:r(()=>[s("div",Me,[n(J,null,{default:r(()=>[n(c(pe))]),_:1}),s("span",null,o(c(e).parameterTool.readMultiple),1)])]),default:r(()=>[s("div",$e,[n(H,{modelValue:C.value,"onUpdate:modelValue":d[2]||(d[2]=a=>C.value=a),placeholder:c(e).parameterTool.selectParameters,filterable:"",multiple:"","allow-create":"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"100%"}},{default:r(()=>[(u(!0),m(N,null,W(k.value,a=>(u(),M(G,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),n(O,{type:"primary",loading:E.value,onClick:i,disabled:C.value.length===0,style:{width:"100%"}},{default:r(()=>[w(o(c(e).parameterTool.read)+" ("+o(C.value.length)+") ",1)]),_:1},8,["loading","disabled"]),V.value?(u(),m("div",Ee,[n(Y,{type:z(V.value),closable:!1,"show-icon":""},{title:r(()=>[w(o(c(e).parameterTool.readResults)+": "+o(V.value.success_count)+" / "+o(V.value.parameters.length),1)]),_:1},8,["type"]),s("div",Ue,[(u(!0),m(N,null,W(V.value.parameters,a=>(u(),m("div",{key:a.name,class:ve(["parameter-item",{"parameter-error":!a.is_valid}])},[s("div",Re,[s("span",Be,o(a.name),1),n(B,{type:a.is_valid?"success":"danger",size:"small"},{default:r(()=>[w(o(a.is_valid?"✓":"✗"),1)]),_:2},1032,["type"])]),s("div",Le,[a.is_valid?(u(),m("span",Ne,[w(o(a.value)+" ",1),a.unit?(u(),m("span",We,o(a.unit),1)):P("",!0)])):(u(),m("span",je,o(a.error_message),1))])],2))),128))])])):P("",!0)])]),_:1}),n(L,{class:"operation-card",shadow:"hover"},{header:r(()=>[s("div",qe,[n(J,null,{default:r(()=>[n(c(me))]),_:1}),s("span",null,o(c(e).parameterTool.write),1)])]),default:r(()=>[s("div",Oe,[n(H,{modelValue:x.value,"onUpdate:modelValue":d[3]||(d[3]=a=>x.value=a),placeholder:c(e).parameterTool.selectParameter,filterable:"","allow-create":"",style:{width:"100%"}},{default:r(()=>[(u(!0),m(N,null,W(k.value,a=>(u(),M(G,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),n(ae,{modelValue:A.value,"onUpdate:modelValue":d[4]||(d[4]=a=>A.value=a),placeholder:c(e).parameterTool.enterValue,controls:!0,precision:2,style:{width:"100%"}},null,8,["modelValue","placeholder"]),s("div",Ge,[n(le,{modelValue:U.value,"onUpdate:modelValue":d[5]||(d[5]=a=>U.value=a)},{default:r(()=>[w(o(c(e).parameterTool.forceWrite),1)]),_:1},8,["modelValue"]),n(te,{content:c(e).parameterTool.forceWriteTooltip,placement:"top"},{default:r(()=>[n(J,{class:"info-icon"},{default:r(()=>[n(c(_e))]),_:1})]),_:1},8,["content"])]),n(O,{type:"danger",loading:R.value,onClick:S,disabled:!x.value||A.value===null,style:{width:"100%"}},{default:r(()=>[w(o(c(e).parameterTool.write),1)]),_:1},8,["loading","disabled"]),b.value?(u(),m("div",He,[n(Y,{type:"success",closable:!1,"show-icon":""},{title:r(()=>[w(o(c(e).parameterTool.writeSuccess),1)]),default:r(()=>[s("div",Je,[s("div",Ke,[s("span",Qe,o(c(e).parameterTool.parameter)+":",1),s("span",Xe,o(b.value.parameter),1)]),s("div",Ye,[s("span",Ze,o(c(e).parameterTool.previousValue)+":",1),s("span",Ie,o(b.value.previous_value??"N/A"),1)]),s("div",ea,[s("span",aa,o(c(e).parameterTool.newValue)+":",1),s("span",la,o(b.value.new_value),1)]),b.value.was_forced?(u(),m("div",ta,[n(B,{type:"warning",size:"small"},{default:r(()=>[w(o(c(e).parameterTool.forcedWrite),1)]),_:1})])):P("",!0)])]),_:1})])):P("",!0)])]),_:1})])):P("",!0),_.value?P("",!0):(u(),M(se,{key:1,description:c(e).parameterTool.selectDeviceFirst,"image-size":150},null,8,["description"]))])}}}),ra=fe(sa,[["__scopeId","data-v-52183ef4"]]);export{ra as default};
